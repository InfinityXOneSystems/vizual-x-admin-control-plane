
name: VIX Sovereign CI

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  validate-backend:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./backend
    steps:
    - uses: actions/checkout@v4
    - name: Use Node.js 20.x
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'
        cache-dependency-path: backend/package-lock.json

    - name: Install dependencies
      run: npm ci
      
    - name: Build
      run: npm run build

  validate-frontend:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Use Node.js 20.x
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        
    - name: Type Check Frontend
      # Since we don't have a build step, we'll install typescript and run tsc for type checking
      run: |
        npm install typescript
        npx tsc --noEmit --lib es2020,dom --jsx react --module esnext --target es2020 $(find . -name "*.ts" -o -name "*.tsx")

  # Placeholder for E2E tests as per contract
  # e2e-tests:
  #   runs-on: ubuntu-latest
  #   needs: [validate-frontend, validate-backend]
  #   steps:
  #   - uses: actions/checkout@v4
  #   - name: Run Playwright tests
  #     run: |
  #       # Install playwright and run tests
  #       echo "E2E Test Suite Placeholder: All tests passed."

